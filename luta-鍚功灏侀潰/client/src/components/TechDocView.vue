<template>
  <div class="tech-doc-view">
    <!-- ç§»åŠ¨ç«¯é¡¶éƒ¨å¯¼èˆª -->
    <div class="mobile-nav">
      <button 
        v-for="section in sections" 
        :key="section.id"
        :class="{ active: currentSection === section.id }"
        @click="currentSection = section.id"
      >
        {{ section.short || section.title }}
      </button>
    </div>

    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo-mark"></div>
        <span>æŠ€æœ¯æ–‡æ¡£</span>
      </div>
      <nav class="nav-list">
        <button 
          v-for="section in sections" 
          :key="section.id"
          :class="{ active: currentSection === section.id }"
          @click="currentSection = section.id"
        >
          <span class="nav-icon">{{ section.icon }}</span>
          <span class="nav-text">{{ section.title }}</span>
        </button>
      </nav>
      <div class="sidebar-footer">
        <span class="version">v1.7</span>
      </div>
    </aside>

    <main class="doc-content">
      <!-- å…¨æ™¯æ€»è§ˆ -->
      <section v-if="currentSection === 'overview'" class="doc-section">
        <header class="section-header">
          <h1>å…¨æ™¯æ€»è§ˆ</h1>
          <p class="subtitle">æœºåˆ¶ Â· è§„åˆ™ Â· é™åˆ¶ Â· æç¤ºè¯å·¥ç¨‹ Â· ä»£ç è½ç‚¹</p>
        </header>

        <div class="overview-grid">
          <div class="overview-card highlight-new">
            <div class="overview-title">ğŸ†• æ™ºèƒ½é€‰åº¦</div>
            <div class="overview-value">LLMè‡ªåŠ¨æ¨å¯¼å…­åº¦</div>
            <div class="overview-meta">DEGREE_SELECT_SYSTEM â†’ degreeKey/confidence/reason/evidenceï¼ˆç½®ä¿¡åº¦â‰¥70%é€šè¿‡ï¼‰</div>
          </div>
          <div class="overview-card highlight-new">
            <div class="overview-title">ğŸ†• æ¨¡å‹å®¹ç¾</div>
            <div class="overview-value">å¤šæ¨¡å‹è½®è¯¢åˆ‡æ¢</div>
            <div class="overview-meta">deepseek-v3.2-think â†’ gpt-5.2ï¼ˆ503/502/è¶…æ—¶è‡ªåŠ¨åˆ‡æ¢ï¼‰</div>
          </div>
          <div class="overview-card">
            <div class="overview-title">æ ¸å¿ƒé“¾è·¯</div>
            <div class="overview-value">é€‰åº¦ â†’ åˆ†æ â†’ Prompt â†’ ç”Ÿå›¾ â†’ è¯„ä¼° â†’ æ„è±¡æ ¡éªŒ</div>
            <div class="overview-meta">selectDegree â†’ analyzeContent â†’ generatePrompt â†’ generateImage â†’ evaluate â†’ verifyImagery</div>
          </div>
          <div class="overview-card">
            <div class="overview-title">æç¤ºè¯å·¥ç¨‹ï¼ˆç³»ç»Ÿ Promptï¼‰</div>
            <div class="overview-value">5 ä»½</div>
            <div class="overview-meta">DEGREE_SELECT_SYSTEM / ANALYZE_SYSTEM / PROMPT_SYSTEM / EVALUATE_SYSTEM / IMAGERY_VERIFY_SYSTEM</div>
          </div>
          <div class="overview-card">
            <div class="overview-title">è´Ÿå‘çº¦æŸï¼ˆNegativeï¼‰</div>
            <div class="overview-value">HARD_NEGATIVES</div>
            <div class="overview-meta">ç”Ÿå›¾é˜¶æ®µæ‹¼æ¥è¿›æœ€ç»ˆ promptï¼ˆStrict constraintsï¼‰</div>
          </div>
          <div class="overview-card">
            <div class="overview-title">éª¨æ¶å¼ºå˜é‡</div>
            <div class="overview-value">ä¸‰ç±»å¼ºå˜é‡å†³å®šéª¨æ¶</div>
            <div class="overview-meta">TopologicalLayout / PrimaryRelationship / RhythmSignatureï¼ˆåº¦ç¦æ­¢å¹²é¢„ï¼‰</div>
          </div>
          <div class="overview-card">
            <div class="overview-title">åå…ˆéªŒæœºåˆ¶</div>
            <div class="overview-value">Anti-ClichÃ©</div>
            <div class="overview-meta">clichÃ© åˆ—è¡¨ + è‡ªæ£€å­—æ®µè¾“å‡º + è§„é¿è¯´æ˜</div>
          </div>
          <div class="overview-card">
            <div class="overview-title">å¯é æ€§æœºåˆ¶</div>
            <div class="overview-value">è½®è¯¢ + è¶…æ—¶æç¤º + å–æ¶ˆ</div>
            <div class="overview-meta">å‰ç«¯è½®è¯¢ /api/task/:taskId</div>
          </div>
        </div>
      </section>

      <!-- æœºåˆ¶æ¸…å• -->
      <section v-if="currentSection === 'mechanisms'" class="doc-section">
        <header class="section-header">
          <h1>æœºåˆ¶æ¸…å•ï¼ˆç©·å°½ç‰ˆï¼‰</h1>
          <p class="subtitle">æŒ‰ç¯èŠ‚ç©·å°½åˆ—å‡ºæ‰€æœ‰å·²å®ç°æœºåˆ¶/è§„åˆ™/é™åˆ¶/æç¤ºè¯å·¥ç¨‹</p>
        </header>

        <div class="impl-block">
          <h3>è§„åˆ™ä¸é™åˆ¶ï¼ˆç¡¬çº¦æŸ/è´Ÿå‘åº“ï¼‰</h3>
          <div class="checklist">
            <div class="check-item">ç¡¬çº¦æŸï¼šå½¢ä½“â‰¤4ã€çº¿æ¡â‰¤3ã€æ¸å˜/å…‰æ™•â‰¤2ã€ç•™ç™½â‰¥50%ã€å®‰å…¨è¾¹è·10%ã€è‰²ç›¸â‰¤3+ä¸­æ€§â‰¤1ï¼ˆPROMPT_SYSTEM å¼ºåˆ¶ + constraintCheck è¾“å‡ºï¼‰</div>
            <div class="check-item">è´Ÿå‘åº“ï¼šHARD_NEGATIVESï¼ˆæ–‡å­—/ç¬¦å·/å…·è±¡/å®—æ•™ç‰©ä»¶/å†™å®3D/éœ“è™¹ç­‰ï¼‰</div>
            <div class="check-item">è´Ÿå‘æ³¨å…¥ï¼š/api/generate-image æŠŠ negativePrompt æ‹¼æ¥åˆ° fullPromptï¼ˆStrict constraintsï¼‰</div>
          </div>
        </div>

        <div class="impl-block highlight-new">
          <h3>ğŸ†• æ™ºèƒ½é€‰åº¦ï¼ˆè‡ªåŠ¨æ¨å¯¼ï¼‰</h3>
          <div class="checklist">
            <div class="check-item">DEGREE_SELECT_SYSTEMï¼šå…­åº¦è¯­ä¹‰å–å‘å®šä¹‰ + JSONè¾“å‡ºè§„èŒƒï¼ˆdegreeKey/confidence/reason/evidence/missingInfoï¼‰</div>
            <div class="check-item">selectDegree()ï¼šLLMè°ƒç”¨ â†’ ç½®ä¿¡åº¦æ ¡éªŒï¼ˆâ‰¥70%é€šè¿‡ï¼Œå¦åˆ™å¼•å¯¼é‡è¯•ï¼‰â†’ è¿”å›é€‰åº¦ç»“æœ</div>
            <div class="check-item">generatePrompt()ï¼šè‹¥æ— æ‰‹åŠ¨degreeåˆ™å…ˆè°ƒselectDegree() â†’ degreeSelectionæ³¨å…¥è¿”å›</div>
            <div class="check-item">å‰ç«¯å±•ç¤ºï¼šæ¨å¯¼è·¯å¾„å¯è§†åŒ– + æ ¸å¿ƒæ¨ç† + æ–‡æœ¬è¯æ® + ç½®ä¿¡åº¦æ¡</div>
            <div class="check-item">å¤±è´¥ç­–ç•¥ï¼šä½ç½®ä¿¡åº¦ä¸ç›²é€‰ï¼Œè¿”å›missingInfoå¼•å¯¼ç”¨æˆ·è¡¥å……å†…å®¹</div>
          </div>
        </div>

        <div class="impl-block highlight-new">
          <h3>ğŸ†• æ¨¡å‹å®¹ç¾åˆ‡æ¢</h3>
          <div class="checklist">
            <div class="check-item">TEXT_MODELS æ•°ç»„ï¼šæŒ‰ä¼˜å…ˆçº§æ’åˆ—ï¼ˆdeepseek-v3.2-think â†’ gpt-5.2ï¼‰</div>
            <div class="check-item">callChatCompletions()ï¼šå¤šæ¨¡å‹è½®è¯¢ + æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆ503/502/è¶…æ—¶è‡ªåŠ¨åˆ‡æ¢ï¼‰</div>
            <div class="check-item">shouldRetryLLM()ï¼šåˆ¤æ–­å¯é‡è¯•é”™è¯¯ç ï¼ˆ429/502/503/504/ECONNRESET/ETIMEDOUTï¼‰</div>
            <div class="check-item">getLLMErrorMessage()ï¼šç”Ÿæˆç”¨æˆ·å‹å¥½é”™è¯¯ä¿¡æ¯</div>
          </div>
        </div>

        <div class="impl-block">
          <h3>éª¨æ¶å¼ºå˜é‡ï¼ˆå†…å®¹å†³å®šéª¨æ¶ï¼‰</h3>
          <div class="checklist">
            <div class="check-item">ANALYZE_SYSTEMï¼šæŠ½å– physicalMetaphor + ä¸‰ç±»å¼ºå˜é‡ + antiTemplateCheck</div>
            <div class="check-item">PROMPT_SYSTEMï¼šå¼ºå˜é‡ä¼˜å…ˆçº§ä¸å¯é€†ï¼›åº¦åªèƒ½å½±å“è¾¹ç¼˜/æè´¨/æ¸©åº¦</div>
            <div class="check-item">userMessage æ³¨å…¥ï¼šæŠŠå¼ºå˜é‡è¡¨æ ¼åŒ–å†™å…¥ prompt ç”Ÿæˆè¾“å…¥ï¼ˆå¼ºåˆ¶æ‰§è¡Œè¯´æ˜ï¼‰</div>
          </div>
        </div>

        <div class="impl-block">
          <h3>åå…ˆéªŒï¼ˆAnti-ClichÃ©ï¼‰</h3>
          <div class="checklist">
            <div class="check-item">åº¦ clichÃ© åˆ—è¡¨ï¼ˆPROMPT_SYSTEM + getDegreeAntiClicheï¼‰</div>
            <div class="check-item">antiClicheCheck è¾“å‡ºå­—æ®µï¼štriggered / avoidedCliche / howAvoided</div>
          </div>
        </div>

        <div class="impl-block">
          <h3>é…è‰²ç³»ç»Ÿï¼ˆéšæœº + çº¦æŸ + å»é‡ + è§†è§‰æŒ‡å¯¼æ³¨å…¥ï¼‰</h3>
          <div class="checklist">
            <div class="check-item">BACKGROUND_COLORSï¼ˆå« temp æ ‡ç­¾ï¼‰</div>
            <div class="check-item">FIVE_COLORSï¼ˆäº”è‰²Ã—6å˜ä½“ï¼Œbrightness/saturationï¼‰</div>
            <div class="check-item">DEGREE_COLOR_RULESï¼ˆåº¦è§„åˆ™ï¼šä¸»è‰²/å¯¹æ¯”è‰²/èƒŒæ™¯æ¸©åº¦/å¯¹æ¯”ç­–ç•¥/ç‚¹ç¼€æ¦‚ç‡ï¼‰</div>
            <div class="check-item">generateColorScheme()ï¼ˆcontrastMethod + accentAreaPct + accentOpacityPctï¼‰</div>
            <div class="check-item">getUniqueColorScheme()ï¼ˆRECENT_COLOR_KEYS_BY_DEGREE çŸ­æœŸå»é‡ï¼‰</div>
            <div class="check-item">getContrastVisualInstruction() / getAccentVisualDescription()ï¼ˆæŠŠæŠ½è±¡å‚æ•°è½¬ä¸ºå¯æ‰§è¡Œè§†è§‰æŒ‡ä»¤ï¼‰</div>
          </div>
        </div>

        <div class="impl-block">
          <h3>ç”Ÿå›¾æ‰§è¡Œä¸å¯é æ€§</h3>
          <div class="checklist">
            <div class="check-item">generateImage()ï¼šå¼‚æ­¥ä»»åŠ¡æ¨¡å¼è¿”å› taskIdï¼ˆsubmittedï¼‰</div>
            <div class="check-item">getTaskStatus()ï¼šè½®è¯¢ä»»åŠ¡çŠ¶æ€å¹¶æå– imageUrl</div>
            <div class="check-item">GeneratorViewï¼šè½®è¯¢ä¸Šé™/è¶…æ—¶æç¤º/å–æ¶ˆç”Ÿæˆ</div>
          </div>
        </div>

        <div class="impl-block">
          <h3>è´¨é‡è¯„ä¼°ä¸æ„è±¡æ ¡éªŒ</h3>
          <div class="checklist">
            <div class="check-item">EVALUATE_SYSTEMï¼šå››ç»´å¿«æ£€ï¼ˆä»»ä¸€ fail å³æ·˜æ±°ï¼‰</div>
            <div class="check-item">IMAGERY_VERIFY_SYSTEM + verifyPromptï¼šæ„è±¡åŒ¹é… + å·¦å³åŒåŸŸä¸¥é‡é—®é¢˜æ£€æµ‹ + æ”¹è¿›å»ºè®®</div>
          </div>
        </div>

        <div class="impl-block">
          <h3>æ•°æ®ç•™å­˜</h3>
          <div class="checklist">
            <div class="check-item">ç”Ÿæˆè®°å½•è½ç›˜ï¼šdata/*.jsonï¼ˆå« prompt/negativePrompt/analysis/taskIdï¼‰</div>
            <div class="check-item">è¯„ä¼°/æ„è±¡æ ¡éªŒå†™å›ï¼š/api/evaluateã€/api/verify-imagery</div>
          </div>
        </div>
      </section>

      <!-- è§„åˆ™ Ã— ç¯èŠ‚çŸ©é˜µ -->
      <section v-if="currentSection === 'matrix'" class="doc-section">
        <header class="section-header">
          <h1>è§„åˆ™ Ã— ç¯èŠ‚çŸ©é˜µ</h1>
          <p class="subtitle">æ¯ä¸ªæœºåˆ¶åœ¨é“¾è·¯ä¸­å…·ä½“åœ¨å“ªäº›ç¯èŠ‚ç”Ÿæ•ˆ</p>
        </header>

        <div class="impl-block">
          <div class="matrix-wrap">
            <div class="matrix-table">
              <div class="matrix-row header">
                <div class="cell row-title">è§„åˆ™/æœºåˆ¶</div>
                <div class="cell">åˆ†æ</div>
                <div class="cell">Prompt</div>
                <div class="cell">ç”Ÿå›¾</div>
                <div class="cell">è½®è¯¢</div>
                <div class="cell">è¯„ä¼°</div>
                <div class="cell">æ„è±¡</div>
                <div class="cell">å­˜å‚¨</div>
                <div class="cell">å‰ç«¯</div>
              </div>

              <div class="matrix-row" v-for="r in matrixRows" :key="r.name">
                <div class="cell row-title">{{ r.name }}</div>
                <div class="cell"><span class="dot" :class="r.analyze ? 'on' : 'off'"></span></div>
                <div class="cell"><span class="dot" :class="r.prompt ? 'on' : 'off'"></span></div>
                <div class="cell"><span class="dot" :class="r.image ? 'on' : 'off'"></span></div>
                <div class="cell"><span class="dot" :class="r.poll ? 'on' : 'off'"></span></div>
                <div class="cell"><span class="dot" :class="r.evaluate ? 'on' : 'off'"></span></div>
                <div class="cell"><span class="dot" :class="r.imagery ? 'on' : 'off'"></span></div>
                <div class="cell"><span class="dot" :class="r.storage ? 'on' : 'off'"></span></div>
                <div class="cell"><span class="dot" :class="r.client ? 'on' : 'off'"></span></div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- æµç¨‹ / æ—¶åºå›¾ -->
      <section v-if="currentSection === 'sequence'" class="doc-section">
        <header class="section-header">
          <h1>æµç¨‹ / æ—¶åºå›¾</h1>
          <p class="subtitle">è¯·æ±‚ã€å“åº”ã€å…³é”®å­—æ®µä¸æ³¨å…¥ç‚¹</p>
        </header>

        <div class="workflow-pipeline">
          <div class="pipeline-step" v-for="(step, idx) in sequenceSteps" :key="step.id">
            <div class="step-connector" v-if="idx > 0"></div>
            <div class="step-card-mini" :class="step.type">
              <div class="step-number">{{ idx + 1 }}</div>
              <div class="step-mini-head">
                <span class="mini-icon">{{ step.icon }}</span>
                <h3>{{ step.title }}</h3>
              </div>
              <p>{{ step.desc }}</p>
              <ul class="step-details" v-if="step.details">
                <li v-for="d in step.details" :key="d">{{ d }}</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="impl-block">
          <h3>å…³é”®æ³¨å…¥ç‚¹ï¼ˆå¿…é¡»çœ‹ï¼‰</h3>
          <div class="checklist">
            <div class="check-item">Prompt ç”Ÿæˆï¼šsystem=PROMPT_SYSTEM + user=userMessageï¼ˆå«å¼ºå˜é‡/åå…ˆéªŒ/é…è‰²æ–¹æ¡ˆ/è§†è§‰æŒ‡å¯¼æ³¨å…¥ï¼‰</div>
            <div class="check-item">ç”Ÿå›¾æ‰§è¡Œï¼šfullPrompt = prompt + Strict constraints + negativePromptï¼ˆnegative ä»¥è‡ªç„¶è¯­è¨€æ³¨å…¥ï¼‰</div>
          </div>
        </div>
      </section>

      <!-- ä»£ç è½ç‚¹ -->
      <section v-if="currentSection === 'code-map'" class="doc-section">
        <header class="section-header">
          <h1>ä»£ç è½ç‚¹ï¼ˆæ–‡ä»¶ / å‡½æ•°ï¼‰</h1>
          <p class="subtitle">æ¯ä¸ªæœºåˆ¶å¯¹åº”çš„å®ç°ä½ç½®ï¼ˆç”¨äºå®¡è®¡ä¸ç»´æŠ¤ï¼‰</p>
        </header>

        <div class="code-map">
          <div class="code-map-card" v-for="f in codeMap" :key="f.path">
            <div class="code-map-head">
              <div class="code-file">{{ f.path }}</div>
              <div class="code-tags">
                <span class="code-tag" v-for="t in f.tags" :key="t">{{ t }}</span>
              </div>
            </div>
            <div class="code-map-body">
              <div class="code-fn" v-for="fn in f.items" :key="fn.name">
                <div class="fn-name">{{ fn.name }}</div>
                <div class="fn-desc">{{ fn.desc }}</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- å®Œæ•´ Prompt / æ³¨å…¥æ®µè½ï¼ˆåŸæ–‡ä»£ç ï¼‰ -->
      <section v-if="currentSection === 'full-prompts'" class="doc-section">
        <header class="section-header">
          <h1>å®Œæ•´ Promptï¼ˆsystem / negative / æ³¨å…¥æ®µè½ï¼‰</h1>
          <p class="subtitle">å±•ç¤ºå½“å‰å®ç°çš„åŸæ–‡ä»£ç ï¼ˆå¯æ»šåŠ¨æŸ¥çœ‹å…¨éƒ¨ï¼‰</p>
        </header>

        <div class="impl-block">
          <h3>server/prompts/system.jsï¼ˆå« system prompt / negative / è¯„ä¼° / æ„è±¡æ ¡éªŒï¼‰</h3>
          <div class="code-block raw">
            <pre>{{ rawFiles.system || 'ï¼ˆåŠ è½½ä¸­...ï¼‰' }}</pre>
          </div>
        </div>

        <div class="impl-block">
          <h3>server/services/llm.jsï¼ˆå« userMessage æ³¨å…¥æ®µè½ + åå…ˆéªŒ + é…è‰²å»é‡ï¼‰</h3>
          <div class="code-block raw">
            <pre>{{ rawFiles.llm || 'ï¼ˆåŠ è½½ä¸­...ï¼‰' }}</pre>
          </div>
        </div>

        <div class="impl-block">
          <h3>server/index.jsï¼ˆå« negativePrompt æ‹¼æ¥è¿›å…¥ fullPrompt çš„æ³¨å…¥æ®µè½ï¼‰</h3>
          <div class="code-block raw">
            <pre>{{ rawFiles.index || 'ï¼ˆåŠ è½½ä¸­...ï¼‰' }}</pre>
          </div>
        </div>

        <div class="impl-block">
          <h3>server/services/evaluate.js / imageGen.js</h3>
          <div class="code-block raw">
            <pre>{{ rawFiles.evaluate || 'ï¼ˆåŠ è½½ä¸­...ï¼‰' }}</pre>
          </div>
          <div class="code-block raw mt">
            <pre>{{ rawFiles.imageGen || 'ï¼ˆåŠ è½½ä¸­...ï¼‰' }}</pre>
          </div>
        </div>
      </section>

      <!-- ç³»ç»Ÿæ¶æ„ -->
      <section v-if="currentSection === 'architecture'" class="doc-section">
        <header class="section-header">
          <h1>ç³»ç»Ÿæ¶æ„</h1>
          <p class="subtitle">å‰åç«¯åˆ†ç¦» + LLM è°ƒç”¨é“¾</p>
        </header>

        <div class="arch-diagram">
          <div class="arch-layer client">
            <div class="layer-label">Frontend (Vue 3 + Vite)</div>
            <div class="layer-content">
              <div class="arch-node">GeneratorView</div>
              <div class="arch-node">DocView</div>
              <div class="arch-node">TechDocView</div>
            </div>
          </div>
          <div class="arch-arrow">â†“ HTTP API â†“</div>
          <div class="arch-layer server">
            <div class="layer-label">Backend (Node.js + Express)</div>
            <div class="layer-content">
              <div class="arch-node">index.js (è·¯ç”±)</div>
              <div class="arch-node">llm.js (LLMæœåŠ¡)</div>
              <div class="arch-node">imageGen.js (ç”Ÿå›¾)</div>
              <div class="arch-node">evaluate.js (è¯„ä¼°)</div>
            </div>
          </div>
          <div class="arch-arrow">â†“ API è°ƒç”¨ â†“</div>
          <div class="arch-layer external">
            <div class="layer-label">External APIs (APIMart)</div>
            <div class="layer-content">
              <div class="arch-node api">DeepSeek (åˆ†æ/Prompt)</div>
              <div class="arch-node api">Gemini (ç”Ÿå›¾)</div>
              <div class="arch-node api">GPT-4o (è¯„ä¼°)</div>
            </div>
          </div>
        </div>

        <div class="tech-cards">
          <div class="tech-card">
            <h3>å‰ç«¯æŠ€æœ¯æ ˆ</h3>
            <ul>
              <li><strong>Vue 3</strong> - Composition API</li>
              <li><strong>Vite</strong> - å¼€å‘æ„å»ºå·¥å…·</li>
              <li><strong>Axios</strong> - HTTP å®¢æˆ·ç«¯</li>
            </ul>
          </div>
          <div class="tech-card">
            <h3>åç«¯æŠ€æœ¯æ ˆ</h3>
            <ul>
              <li><strong>Node.js</strong> - è¿è¡Œæ—¶</li>
              <li><strong>Express</strong> - Web æ¡†æ¶</li>
              <li><strong>UUID</strong> - è®°å½•IDç”Ÿæˆ</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- LLM è°ƒç”¨é“¾ -->
      <section v-if="currentSection === 'llm-chain'" class="doc-section">
        <header class="section-header">
          <h1>LLM è°ƒç”¨é“¾</h1>
          <p class="subtitle">ä¸‰é˜¶æ®µ LLM åä½œæµç¨‹</p>
        </header>

        <div class="chain-flow">
          <div class="chain-step">
            <div class="step-badge">1</div>
            <div class="step-card">
              <h3>å†…å®¹åˆ†æ</h3>
              <div class="step-model">DeepSeek V3.2</div>
              <p>ä»æ’­å®¢æ–‡æœ¬æå–ï¼š</p>
              <ul>
                <li>æ ¸å¿ƒæ„è±¡ (imagery)</li>
                <li>æƒ…æ„ŸåŸºè°ƒ (emotion)</li>
                <li>çµæ€§æ°”è´¨ (spiritualTone)</li>
                <li>å™äº‹å¼ åŠ› (tension)</li>
                <li>ä¸‰ç±»éª¨æ¶å¼ºå˜é‡</li>
              </ul>
            </div>
          </div>
          <div class="chain-connector"></div>
          <div class="chain-step">
            <div class="step-badge">2</div>
            <div class="step-card">
              <h3>Prompt ç”Ÿæˆ</h3>
              <div class="step-model">DeepSeek V3.2</div>
              <p>åŸºäºåˆ†æç»“æœæ„å»ºï¼š</p>
              <ul>
                <li>éª¨æ¶å¼ºå˜é‡çº¦æŸ</li>
                <li>åº¦çš„æ°›å›´åç½®</li>
                <li>éšæœºé…è‰²æ–¹æ¡ˆ</li>
                <li>åå…ˆéªŒæ£€æŸ¥</li>
                <li>â‰¥200è¯è¯¦ç»†Prompt</li>
              </ul>
            </div>
          </div>
          <div class="chain-connector"></div>
          <div class="chain-step">
            <div class="step-badge">3</div>
            <div class="step-card">
              <h3>å›¾ç‰‡ç”Ÿæˆ</h3>
              <div class="step-model">Gemini 3 Pro</div>
              <p>æ‰§è¡Œæ–‡ç”Ÿå›¾ï¼š</p>
              <ul>
                <li>aspect_ratio: 1:1</li>
                <li>å¼‚æ­¥ä»»åŠ¡æ¨¡å¼</li>
                <li>è½®è¯¢çŠ¶æ€ç›´åˆ°å®Œæˆ</li>
              </ul>
            </div>
          </div>
          <div class="chain-connector"></div>
          <div class="chain-step">
            <div class="step-badge">4</div>
            <div class="step-card">
              <h3>è´¨é‡è¯„ä¼°</h3>
              <div class="step-model">GPT-4o Vision</div>
              <p>å¤šç»´åº¦å¿«æ£€ï¼š</p>
              <ul>
                <li>ç»“æ„å¿«æ£€ (complexity)</li>
                <li>é¢œè‰²å¿«æ£€ (color)</li>
                <li>æŠ½è±¡å¿«æ£€ (abstraction)</li>
                <li>å“è´¨å¿«æ£€ (aesthetic)</li>
                <li>æ„è±¡æ ¡éªŒ (verify-imagery)</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- é…è‰²ç³»ç»Ÿ -->
      <section v-if="currentSection === 'color-system'" class="doc-section">
        <header class="section-header">
          <h1>é…è‰²ç³»ç»Ÿå®ç°</h1>
          <p class="subtitle">äº”è‰²æ¯åº“ Ã— åº¦è§„åˆ™ Ã— éšæœºç­–ç•¥</p>
        </header>

        <div class="impl-block">
          <h3>FIVE_COLORS äº”è‰²æ¯åº“</h3>
          <p>æ¯ç§é¢œè‰² 6 ä¸ªå˜ä½“ï¼ŒåŒ…å« brightness å’Œ saturation å±æ€§</p>
          <div class="color-demo">
            <div class="color-row" v-for="(color, name) in colorDemo" :key="name">
              <span class="color-name">{{ name }}</span>
              <div class="color-variants">
                <div 
                  class="color-chip" 
                  v-for="v in color" 
                  :key="v.hex"
                  :style="{ backgroundColor: v.hex }"
                  :title="`${v.name}: ${v.hex}`"
                ></div>
              </div>
            </div>
          </div>
        </div>

        <div class="impl-block">
          <h3>DEGREE_COLOR_RULES åº¦é…è‰²è§„åˆ™</h3>
          <div class="rule-table">
            <div class="rule-row header">
              <span>åº¦</span>
              <span>ä¸»è‰²</span>
              <span>å¯¹æ¯”è‰²</span>
              <span>èƒŒæ™¯æ¸©åº¦</span>
              <span>å¯¹æ¯”ç­–ç•¥</span>
            </div>
            <div class="rule-row" v-for="rule in degreeRules" :key="rule.key">
              <span class="rule-name">{{ rule.name }}</span>
              <span>{{ rule.primary.join('/') }}</span>
              <span>{{ rule.accent.join('/') }}</span>
              <span>{{ rule.bgTemp }}</span>
              <span>{{ rule.contrast.join(', ') }}</span>
            </div>
          </div>
        </div>

        <div class="impl-block">
          <h3>generateColorScheme() éšæœºé…è‰²å‡½æ•°</h3>
          <div class="code-block">
            <pre>function generateColorScheme(degreeKey) {
  const rule = DEGREE_COLOR_RULES[degreeKey];
  
  // 1. éšæœºé€‰ä¸»è‰²ç›¸ â†’ é€‰å˜ä½“
  const primaryHue = pickOne(rule.primaryHues);
  const primaryVariant = selectColorVariant(primaryHue, ...);
  
  // 2. éšæœºé€‰å¯¹æ¯”ç­–ç•¥
  const contrastMethod = pickOne(rule.allowedContrastMethods);
  
  // 3. æ ¹æ®æ¦‚ç‡å†³å®šæ˜¯å¦ä½¿ç”¨å¯¹æ¯”è‰²
  const useAccent = Math.random() &lt; rule.accentProbability;
  
  // 4. é€‰èƒŒæ™¯è‰²ï¼ˆåŒ¹é…æ¸©åº¦åå¥½ï¼‰
  const bgColor = pickOne(eligibleBgs);
  
  return { primaryColor, accentColor, background, contrastMethod, ... };
}</pre>
          </div>
        </div>

        <div class="impl-block">
          <h3>çŸ­æœŸå»é‡æœºåˆ¶</h3>
          <p>é˜²æ­¢è¿ç»­ç”Ÿæˆç›¸åŒé…è‰²ï¼š</p>
          <div class="code-block">
            <pre>const RECENT_COLOR_KEYS_BY_DEGREE = new Map();

function getUniqueColorScheme(degreeKey, attempts = 10, recentLimit = 8) {
  const list = RECENT_COLOR_KEYS_BY_DEGREE.get(degreeKey) || [];
  for (let i = 0; i &lt; attempts; i++) {
    const scheme = generateColorScheme(degreeKey);
    const key = colorKeyFromScheme(scheme);
    if (!list.includes(key)) {
      // è®°å½•å¹¶è¿”å›
      RECENT_COLOR_KEYS_BY_DEGREE.set(degreeKey, [key, ...list].slice(0, recentLimit));
      return scheme;
    }
  }
  // å…œåº•è¿”å›
  return generateColorScheme(degreeKey);
}</pre>
          </div>
        </div>
      </section>

      <!-- éª¨æ¶å¼ºå˜é‡ -->
      <section v-if="currentSection === 'skeleton-vars'" class="doc-section">
        <header class="section-header">
          <h1>éª¨æ¶å¼ºå˜é‡ç³»ç»Ÿ</h1>
          <p class="subtitle">å†…å®¹é©±åŠ¨éª¨æ¶ï¼Œåº¦ç¦æ­¢å¹²é¢„</p>
        </header>

        <div class="var-cards">
          <div class="var-card">
            <div class="var-header">
              <span class="var-num">1</span>
              <h3>TopologicalLayout</h3>
            </div>
            <p class="var-desc">æ‹“æ‰‘å¸ƒå±€ - ç”»é¢åˆ†å‡ ä¸ªåŒºåŸŸã€å¦‚ä½•åˆ†ç•Œ</p>
            <ul>
              <li><strong>zoneCount</strong>: åŒºåŸŸæ•°é‡ (1-4)</li>
              <li><strong>divisionMethod</strong>: åˆ†ç•Œæ–¹å¼ (diagonal, horizontal, vertical, radial, organic)</li>
              <li><strong>zoneRatios</strong>: åŒºåŸŸæ¯”ä¾‹</li>
            </ul>
          </div>
          <div class="var-card">
            <div class="var-header">
              <span class="var-num">2</span>
              <h3>PrimaryRelationship</h3>
            </div>
            <p class="var-desc">ä¸»å…³ç³» - ä¸»å½¢ä½“ä¹‹é—´çš„ç©ºé—´å…³ç³»</p>
            <ul>
              <li><strong>type</strong>: å…³ç³»ç±»å‹ (solo, parallel, opposing, nested, scattered)</li>
              <li><strong>interactionQuality</strong>: äº¤äº’è´¨é‡ (static, dynamic, tense)</li>
              <li><strong>spatialPosition</strong>: ç©ºé—´ä½ç½®</li>
            </ul>
          </div>
          <div class="var-card">
            <div class="var-header">
              <span class="var-num">3</span>
              <h3>RhythmSignature</h3>
            </div>
            <p class="var-desc">èŠ‚å¥ç­¾å - å¤šå…ƒç´ çš„é—´è·/å¤§å°è§„å¾‹</p>
            <ul>
              <li><strong>type</strong>: èŠ‚å¥ç±»å‹ (uniform, accelerating, decelerating, syncopated)</li>
              <li><strong>elementCount</strong>: å…ƒç´ æ•°é‡</li>
            </ul>
          </div>
        </div>

        <div class="impl-block">
          <h3>åå…ˆéªŒæœºåˆ¶ (Anti-ClichÃ©)</h3>
          <p>æ¯ä¸ªåº¦æœ‰å…¸å‹çš„ clichÃ© éœ€è¦è§„é¿ï¼š</p>
          <div class="cliche-table">
            <div class="cliche-row" v-for="c in cliches" :key="c.degree">
              <span class="cliche-degree">{{ c.degree }}</span>
              <span class="cliche-bad">âŒ {{ c.cliche }}</span>
              <span class="cliche-good">âœ… {{ c.avoid }}</span>
            </div>
          </div>
        </div>
      </section>

      <!-- API æ¥å£ -->
      <section v-if="currentSection === 'api'" class="doc-section">
        <header class="section-header">
          <h1>API æ¥å£</h1>
          <p class="subtitle">åç«¯ RESTful API åˆ—è¡¨</p>
        </header>

        <div class="api-list">
          <div class="api-item" v-for="api in apis" :key="api.path">
            <div class="api-header">
              <span class="api-method" :class="api.method.toLowerCase()">{{ api.method }}</span>
              <span class="api-path">{{ api.path }}</span>
            </div>
            <p class="api-desc">{{ api.desc }}</p>
            <div class="api-params" v-if="api.params">
              <span class="param-label">å‚æ•°ï¼š</span>
              <code>{{ api.params }}</code>
            </div>
          </div>
        </div>
      </section>

      <!-- æ•°æ®å­˜å‚¨ -->
      <section v-if="currentSection === 'storage'" class="doc-section">
        <header class="section-header">
          <h1>æ•°æ®å­˜å‚¨</h1>
          <p class="subtitle">JSON æ–‡ä»¶å­˜å‚¨ç”Ÿæˆè®°å½•</p>
        </header>

        <div class="impl-block">
          <h3>å­˜å‚¨ä½ç½®</h3>
          <p><code>luta-cover-generator/data/*.json</code></p>
        </div>

        <div class="impl-block">
          <h3>è®°å½•ç»“æ„</h3>
          <div class="code-block">
            <pre>{
  "id": "uuid",
  "taskId": "task_xxx",
  "degree": "dana",
  "podcastContent": "...",
  "analysis": { ... },
  "prompt": "...",
  "negativePrompt": "...",
  "status": "completed",
  "imageUrl": "https://...",
  "evaluation": { ... },
  "imageryVerification": { ... },
  "createdAt": "2025-12-27T...",
  "evaluatedAt": "2025-12-27T...",
  "verifiedAt": "2025-12-27T..."
}</pre>
          </div>
        </div>
      </section>
    </main>
  </div>
</template>

<script setup>
import { onMounted, ref } from 'vue';

const currentSection = ref('overview');

const sections = [
  { id: 'overview', title: 'å…¨æ™¯æ€»è§ˆ', short: 'æ€»è§ˆ', icon: 'â—' },
  { id: 'mechanisms', title: 'æœºåˆ¶æ¸…å•', short: 'æ¸…å•', icon: 'â–¤' },
  { id: 'matrix', title: 'æœºåˆ¶çŸ©é˜µ', short: 'çŸ©é˜µ', icon: 'â–£' },
  { id: 'sequence', title: 'æµç¨‹æ—¶åº', short: 'æ—¶åº', icon: 'â—‡' },
  { id: 'code-map', title: 'ä»£ç è½ç‚¹', short: 'è½ç‚¹', icon: 'â—§' },
  { id: 'full-prompts', title: 'å®Œæ•´Prompt', short: 'Prompt', icon: 'âœ¦' },
  { id: 'architecture', title: 'ç³»ç»Ÿæ¶æ„', short: 'æ¶æ„', icon: 'â–£' },
  { id: 'llm-chain', title: 'LLM è°ƒç”¨é“¾', short: 'é“¾è·¯', icon: 'â—' },
  { id: 'color-system', title: 'é…è‰²ç³»ç»Ÿ', short: 'é…è‰²', icon: 'â—' },
  { id: 'skeleton-vars', title: 'éª¨æ¶å¼ºå˜é‡', short: 'éª¨æ¶', icon: 'â—‡' },
  { id: 'api', title: 'API æ¥å£', short: 'æ¥å£', icon: 'âœ¦' },
  { id: 'storage', title: 'æ•°æ®å­˜å‚¨', short: 'å­˜å‚¨', icon: 'â—§' }
];

const matrixRows = [
  { name: 'ğŸ†• æ™ºèƒ½é€‰åº¦ï¼ˆDEGREE_SELECT_SYSTEMï¼‰', analyze: true, prompt: true, image: false, poll: false, evaluate: false, imagery: false, storage: true, client: true },
  { name: 'ğŸ†• æ¨¡å‹å®¹ç¾åˆ‡æ¢ï¼ˆå¤šæ¨¡å‹è½®è¯¢ï¼‰', analyze: true, prompt: true, image: false, poll: false, evaluate: true, imagery: true, storage: false, client: false },
  { name: 'ç¡¬çº¦æŸï¼ˆç»“æ„/é¢œè‰²/ç•™ç™½ï¼‰', analyze: false, prompt: true, image: false, poll: false, evaluate: true, imagery: true, storage: false, client: true },
  { name: 'Negativeï¼ˆHARD_NEGATIVESï¼‰', analyze: false, prompt: false, image: true, poll: false, evaluate: true, imagery: true, storage: true, client: true },
  { name: 'éª¨æ¶å¼ºå˜é‡ï¼ˆä¸‰ç±»å¼ºå˜é‡ï¼‰', analyze: true, prompt: true, image: false, poll: false, evaluate: false, imagery: true, storage: true, client: true },
  { name: 'åå…ˆéªŒï¼ˆAnti-ClichÃ©ï¼‰', analyze: true, prompt: true, image: false, poll: false, evaluate: false, imagery: true, storage: true, client: true },
  { name: 'é…è‰²ç³»ç»Ÿï¼ˆéšæœº+çº¦æŸï¼‰', analyze: false, prompt: true, image: false, poll: false, evaluate: true, imagery: false, storage: true, client: true },
  { name: 'çŸ­æœŸå»é‡ï¼ˆé¢œè‰²ï¼‰', analyze: false, prompt: true, image: false, poll: false, evaluate: false, imagery: false, storage: false, client: false },
  { name: 'å¼‚æ­¥ä»»åŠ¡ç”Ÿå›¾', analyze: false, prompt: false, image: true, poll: true, evaluate: false, imagery: false, storage: true, client: true },
  { name: 'å¿«æ£€è¯„ä¼°ï¼ˆEVALUATE_SYSTEMï¼‰', analyze: false, prompt: false, image: false, poll: false, evaluate: true, imagery: false, storage: true, client: true },
  { name: 'æ„è±¡æ ¡éªŒï¼ˆIMAGERY_VERIFY_SYSTEMï¼‰', analyze: true, prompt: false, image: false, poll: false, evaluate: false, imagery: true, storage: true, client: true }
];

const sequenceSteps = [
  { id: 'degree', type: 'llm', icon: '0', title: 'ğŸ†• æ™ºèƒ½é€‰åº¦', desc: 'selectDegree()', details: ['DEGREE_SELECT_SYSTEM â†’ degreeKey/confidence/reason/evidence', 'ç½®ä¿¡åº¦â‰¥70%é€šè¿‡ï¼Œå¦åˆ™è¿”å›missingInfoå¼•å¯¼é‡è¯•', 'å¤šæ¨¡å‹è½®è¯¢ï¼ˆdeepseekâ†’gpt-5.2ï¼‰'] },
  { id: 'analyze', type: 'llm', icon: '1', title: 'å†…å®¹åˆ†æ', desc: 'analyzeContent()', details: ['ANALYZE_SYSTEM â†’ JSON è¾“å‡ºï¼ˆæ„è±¡/å¼ºå˜é‡ï¼‰', 'å¤šæ¨¡å‹å®¹ç¾åˆ‡æ¢'] },
  { id: 'prompt', type: 'logic', icon: '2', title: 'ç”Ÿæˆæç¤ºè¯', desc: 'generatePrompt()', details: ['è‹¥æ— degreeåˆ™å…ˆè°ƒselectDegree()', 'system=PROMPT_SYSTEM', 'user=userMessageï¼ˆå¼ºå˜é‡/åå…ˆéªŒ/é…è‰²æ³¨å…¥ï¼‰'] },
  { id: 'image', type: 'gen', icon: '3', title: 'ç”Ÿå›¾æäº¤', desc: 'POST /api/generate-image', details: ['fullPrompt = prompt + Strict constraints + negativePrompt', 'è¿”å› taskIdï¼ˆå¼‚æ­¥ï¼‰'] },
  { id: 'poll', type: 'verify', icon: '4', title: 'è½®è¯¢ä»»åŠ¡', desc: 'GET /api/task/:taskId', details: ['å‰ç«¯è½®è¯¢/è¶…æ—¶æç¤º/å–æ¶ˆ'] },
  { id: 'eval', type: 'verify', icon: '5', title: 'å¿«æ£€è¯„ä¼°', desc: 'POST /api/evaluate', details: ['EVALUATE_SYSTEM â†’ pass/score'] },
  { id: 'imagery', type: 'verify', icon: '6', title: 'æ„è±¡æ ¡éªŒ', desc: 'POST /api/verify-imagery', details: ['IMAGERY_VERIFY_SYSTEM', 'å·¦å³åŒåŸŸæ£€æµ‹ + æ”¹è¿›å»ºè®®'] }
];

const codeMap = [
  {
    path: 'server/prompts/system.js',
    tags: ['è§„åˆ™åº“', 'ç³»ç»ŸPrompt', 'è´Ÿå‘åº“', 'é…è‰²æ¯åº“', 'ğŸ†•é€‰åº¦'],
    items: [
      { name: 'ğŸ†• DEGREE_SELECT_SYSTEM', desc: 'æ™ºèƒ½é€‰åº¦ç³»ç»Ÿæç¤ºè¯ï¼ˆå…­åº¦è¯­ä¹‰å–å‘ + ç½®ä¿¡åº¦è¾“å‡ºè§„èŒƒï¼‰' },
      { name: 'ANALYZE_SYSTEM', desc: 'å†…å®¹åˆ†æç³»ç»Ÿæç¤ºè¯ï¼ˆè¾“å‡ºå¼ºå˜é‡ä¸åæ¨¡æ¿æ£€æŸ¥ï¼‰' },
      { name: 'PROMPT_SYSTEM', desc: 'Prompt ç”Ÿæˆç³»ç»Ÿæç¤ºè¯ï¼ˆå¼ºå˜é‡ä¼˜å…ˆçº§ + åå…ˆéªŒ + ç¡¬çº¦æŸï¼‰' },
      { name: 'HARD_NEGATIVES', desc: 'å¼ºåˆ¶è´Ÿå‘åº“ï¼ˆæ–‡å­—/ç¬¦å·/å…·è±¡/é£æ ¼ç¦å¿Œï¼‰' },
      { name: 'EVALUATE_SYSTEM', desc: 'å¿«æ£€è¯„ä¼°ç³»ç»Ÿæç¤ºè¯ï¼ˆå››ç»´æ·˜æ±°è§„åˆ™ï¼‰' },
      { name: 'IMAGERY_VERIFY_SYSTEM', desc: 'æ„è±¡æ ¡éªŒç³»ç»Ÿæç¤ºè¯ï¼ˆå·¦å³åŒåŸŸä¸¥é‡é—®é¢˜ï¼‰' },
      { name: 'FIVE_COLORS / DEGREE_COLOR_RULES / generateColorScheme', desc: 'é…è‰²æ¯åº“ä¸åº¦è§„åˆ™ + éšæœºç”Ÿæˆ' }
    ]
  },
  {
    path: 'server/services/llm.js',
    tags: ['æç¤ºè¯å·¥ç¨‹', 'å»é‡', 'åå…ˆéªŒ', 'æ³¨å…¥æ®µè½', 'ğŸ†•å®¹ç¾'],
    items: [
      { name: 'ğŸ†• selectDegree()', desc: 'æ™ºèƒ½é€‰åº¦ï¼šDEGREE_SELECT_SYSTEMè°ƒç”¨ + ç½®ä¿¡åº¦æ ¡éªŒï¼ˆâ‰¥70%é€šè¿‡ï¼‰' },
      { name: 'ğŸ†• callChatCompletions()', desc: 'å¤šæ¨¡å‹è½®è¯¢ + æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆ503/502è‡ªåŠ¨åˆ‡æ¢ï¼‰' },
      { name: 'ğŸ†• shouldRetryLLM()', desc: 'åˆ¤æ–­å¯é‡è¯•é”™è¯¯ç ï¼ˆ429/502/503/504/ECONNRESETï¼‰' },
      { name: 'analyzeContent()', desc: 'è°ƒç”¨ ANALYZE_SYSTEM è¾“å‡º JSONï¼ˆä½¿ç”¨å®¹ç¾æœºåˆ¶ï¼‰' },
      { name: 'generatePrompt()', desc: 'è‹¥æ— degreeåˆ™å…ˆè°ƒselectDegree() + æ³¨å…¥degreeSelection' },
      { name: 'getUniqueColorScheme()', desc: 'çŸ­æœŸå»é‡ï¼ˆRECENT_COLOR_KEYS_BY_DEGREEï¼‰' },
      { name: 'getContrastVisualInstruction()', desc: 'å¯¹æ¯”ç­–ç•¥è§†è§‰æŒ‡ä»¤æ³¨å…¥' },
      { name: 'getAccentVisualDescription()', desc: 'ç‚¹ç¼€é¢ç§¯/ä¸é€æ˜åº¦è§†è§‰æŒ‡ä»¤æ³¨å…¥' },
      { name: 'getDegreeAntiCliche()', desc: 'æ¯åº¦ clichÃ© ä¸è§„é¿è¯´æ˜' }
    ]
  },
  {
    path: 'server/index.js',
    tags: ['API', 'æ³¨å…¥', 'å­˜å‚¨'],
    items: [
      { name: 'POST /api/generate-image', desc: 'negativePrompt æ‹¼æ¥è¿› fullPromptï¼ˆStrict constraintsï¼‰' },
      { name: 'data/*.json', desc: 'ç”Ÿæˆè®°å½•/è¯„ä¼°/æ„è±¡æ ¡éªŒè½ç›˜' }
    ]
  },
  {
    path: 'server/services/imageGen.js',
    tags: ['ç”Ÿå›¾', 'å¼‚æ­¥ä»»åŠ¡', 'è½®è¯¢'],
    items: [
      { name: 'generateImage()', desc: 'æäº¤æ–‡ç”Ÿå›¾ï¼ˆaspect_ratio: 1:1ï¼‰' },
      { name: 'getTaskStatus()', desc: 'æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€å¹¶æå– imageUrl' }
    ]
  },
  {
    path: 'server/services/evaluate.js',
    tags: ['è¯„ä¼°', 'æ„è±¡æ ¡éªŒ'],
    items: [
      { name: 'evaluateImage()', desc: 'ä½¿ç”¨ EVALUATE_SYSTEM å¿«æ£€è¯„åˆ†' },
      { name: 'verifyImagery()', desc: 'ä½¿ç”¨ IMAGERY_VERIFY_SYSTEM + verifyPrompt æ„è±¡æ ¡éªŒ' }
    ]
  },
  {
    path: 'client/src/components/GeneratorView.vue',
    tags: ['å‰ç«¯', 'è½®è¯¢', 'å–æ¶ˆ', 'è¶…æ—¶æç¤º'],
    items: [
      { name: 'pollTaskStatus()', desc: 'è½®è¯¢ /api/task/:taskIdï¼ˆä¸Šé™ + è¶…æ—¶æç¤ºï¼‰' },
      { name: 'cancelGeneration()', desc: 'å–æ¶ˆç”Ÿæˆï¼Œåœæ­¢è½®è¯¢' }
    ]
  }
];

const rawFiles = ref({
  system: '',
  llm: '',
  index: '',
  evaluate: '',
  imageGen: ''
});

onMounted(async () => {
  const load = async (url) => {
    const res = await fetch(url, { cache: 'no-store' });
    return await res.text();
  };
  try { rawFiles.value.system = await load('/tech/server_prompts_system.js'); } catch {}
  try { rawFiles.value.llm = await load('/tech/server_services_llm.js'); } catch {}
  try { rawFiles.value.index = await load('/tech/server_index.js'); } catch {}
  try { rawFiles.value.evaluate = await load('/tech/server_services_evaluate.js'); } catch {}
  try { rawFiles.value.imageGen = await load('/tech/server_services_imageGen.js'); } catch {}
});

const colorDemo = {
  'è“': [
    { name: 'ice', hex: '#E8F4FC' },
    { name: 'sky', hex: '#D6EAF8' },
    { name: 'powder', hex: '#85C1E9' }
  ],
  'é»„': [
    { name: 'cream', hex: '#FFF9E6' },
    { name: 'gold', hex: '#FFF3CD' },
    { name: 'amber', hex: '#FFE082' }
  ],
  'çº¢': [
    { name: 'blush', hex: '#FFEBEE' },
    { name: 'rose', hex: '#FFCDD2' },
    { name: 'coral', hex: '#FFAB91' }
  ],
  'ç»¿': [
    { name: 'mint', hex: '#E8F5E9' },
    { name: 'sage', hex: '#C8E6C9' },
    { name: 'spring', hex: '#A5D6A7' }
  ],
  'ç™½': [
    { name: 'pure', hex: '#FFFFFF' },
    { name: 'cloud', hex: '#FAFAFA' },
    { name: 'fog', hex: '#F5F5F5' }
  ]
};

const degreeRules = [
  { key: 'dana', name: 'å¸ƒæ–½', primary: ['é»„', 'ç»¿'], accent: ['è“', 'çº¢'], bgTemp: 'warm', contrast: ['area', 'brightness', 'warm-cool'] },
  { key: 'sila', name: 'æŒæˆ’', primary: ['ç™½', 'è“'], accent: ['çº¢', 'é»„'], bgTemp: 'cool', contrast: ['brightness', 'area'] },
  { key: 'ksanti', name: 'å¿è¾±', primary: ['ç™½', 'è“'], accent: ['çº¢', 'é»„'], bgTemp: 'neutral', contrast: ['layering', 'brightness'] },
  { key: 'virya', name: 'ç²¾è¿›', primary: ['çº¢', 'é»„'], accent: ['è“', 'ç»¿'], bgTemp: 'warm', contrast: ['brightness', 'area', 'warm-cool'] },
  { key: 'samadhi', name: 'ç¦…å®š', primary: ['ç™½', 'è“', 'ç»¿'], accent: ['é»„'], bgTemp: 'cool', contrast: ['none', 'brightness'] },
  { key: 'prajna', name: 'èˆ¬è‹¥', primary: ['ç™½', 'è“', 'é»„'], accent: ['ç»¿', 'çº¢'], bgTemp: 'neutral', contrast: ['warm-cool', 'brightness', 'area'] }
];

const cliches = [
  { degree: 'å¸ƒæ–½', cliche: 'å‘å¤–æ‰©æ•£çš„åŒå¿ƒåœ†', avoid: 'è¾¹ç¼˜æ¸éšã€ç•™ç™½åˆ†å¸ƒ' },
  { degree: 'æŒæˆ’', cliche: 'çŸ©å½¢æ¡†æ¶/ç½‘æ ¼çº¿', avoid: 'æ¸…æ™°è¾¹ç¼˜ã€è§„æ•´é—´è·' },
  { degree: 'å¿è¾±', cliche: 'ä¸¤è‚¡ç›¸å‘çš„æŸ”å’Œå½¢ä½“', avoid: 'æŸ”è½¯è¾¹ç¼˜ã€å±‚æ¬¡å åŠ ' },
  { degree: 'ç²¾è¿›', cliche: 'é˜¶æ¢¯å¼é€’è¿›', avoid: 'èŠ‚å¥å˜åŒ–ã€æ˜åº¦é€’è¿›' },
  { degree: 'ç¦…å®š', cliche: 'ä¸­å¿ƒåŒå¿ƒåœ†/ç¯', avoid: 'å¤§é¢ç§¯ç•™ç™½ã€é™æ­¢æ„Ÿ' },
  { degree: 'èˆ¬è‹¥', cliche: 'å·¦å³åˆ‡åˆ†/åŒåŸŸå¯¹ç…§', avoid: 'æ˜åº¦å¯¹æ¯”ã€æ¸…æ™°è¾¹ç•Œ' }
];

const apis = [
  { method: 'GET', path: '/api/degrees', desc: 'è·å–å…­åº¦åˆ—è¡¨', params: null },
  { method: 'POST', path: '/api/analyze', desc: 'åˆ†ææ’­å®¢å†…å®¹', params: '{ podcastContent }' },
  { method: 'POST', path: '/api/generate-prompt', desc: 'ç”Ÿæˆæç¤ºè¯', params: '{ podcastContent, degree, analysisResult?, improvementSuggestions? }' },
  { method: 'POST', path: '/api/generate-image', desc: 'ç”Ÿæˆå›¾ç‰‡', params: '{ prompt, negativePrompt, degree, ... }' },
  { method: 'GET', path: '/api/task/:taskId', desc: 'æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€', params: null },
  { method: 'POST', path: '/api/evaluate', desc: 'è¯„ä¼°å›¾ç‰‡', params: '{ imageUrl, recordId? }' },
  { method: 'POST', path: '/api/verify-imagery', desc: 'æ„è±¡æ ¡éªŒ', params: '{ imageUrl, analysisResult, recordId? }' },
  { method: 'GET', path: '/api/history', desc: 'è·å–å†å²è®°å½•', params: null }
];
</script>

<style scoped>
.tech-doc-view {
  --sidebar-width: 220px;
  --content-max: 1100px;
  --gap-xs: 8px;
  --gap-sm: 12px;
  --gap-md: 20px;
  --gap-lg: 32px;
  --gap-xl: 48px;
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.04);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.06);
  --shadow-lg: 0 8px 24px rgba(0,0,0,0.08);
  --c-bg: #F7F7F8;
  --c-surface: #FFFFFF;
  --c-surface-alt: #FAFAFA;
  --c-border: #E5E5E7;
  --c-border-light: #F0F0F2;
  --c-text: #1D1D1F;
  --c-text-secondary: #6E6E73;
  --c-text-muted: #AEAEB2;
  --c-accent: #0A7B4E;
  --c-accent-bg: #E6F4EE;
  --c-warning: #FF9500;
  --c-danger: #FF3B30;
  --c-info: #007AFF;

  display: flex;
  min-height: calc(100vh - 73px);
  background: var(--c-bg);
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, sans-serif;
}

/* ===== ç§»åŠ¨ç«¯å¯¼èˆª ===== */
.mobile-nav {
  display: none;
  position: fixed;
  top: 73px;
  left: 0;
  right: 0;
  z-index: 100;
  background: var(--c-surface);
  border-bottom: 1px solid var(--c-border);
  padding: 8px 12px;
  overflow-x: auto;
  gap: 6px;
  -webkit-overflow-scrolling: touch;
}
.mobile-nav::-webkit-scrollbar { display: none; }
.mobile-nav button {
  flex-shrink: 0;
  padding: 8px 14px;
  border: 1px solid var(--c-border);
  border-radius: 20px;
  background: var(--c-surface);
  font-size: 0.85rem;
  color: var(--c-text-secondary);
  cursor: pointer;
  transition: all 0.2s;
}
.mobile-nav button.active {
  background: var(--c-accent);
  border-color: var(--c-accent);
  color: white;
}

/* ===== Sidebar ===== */
.sidebar {
  width: var(--sidebar-width);
  background: var(--c-surface);
  border-right: 1px solid var(--c-border);
  display: flex;
  flex-direction: column;
  position: sticky;
  top: 73px;
  height: calc(100vh - 73px);
}
.sidebar-header {
  padding: 24px 20px 16px;
  display: flex;
  align-items: center;
  gap: 10px;
  border-bottom: 1px solid var(--c-border-light);
}
.logo-mark {
  width: 24px;
  height: 24px;
  background: linear-gradient(135deg, var(--c-accent), #0EA5A1);
  border-radius: 6px;
}
.sidebar-header span {
  font-size: 0.95rem;
  font-weight: 600;
  color: var(--c-text);
}
.nav-list {
  flex: 1;
  padding: 12px 0;
  overflow-y: auto;
}
.nav-list button {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  padding: 12px 20px;
  border: none;
  background: transparent;
  font-size: 0.9rem;
  color: var(--c-text-secondary);
  cursor: pointer;
  transition: all 0.15s;
  text-align: left;
}
.nav-list button:hover { background: var(--c-surface-alt); color: var(--c-text); }
.nav-list button.active { background: var(--c-accent-bg); color: var(--c-accent); font-weight: 500; }
.nav-list button.active .nav-icon { color: var(--c-accent); }
.nav-icon { width: 20px; text-align: center; font-size: 1rem; color: var(--c-text-muted); }

.sidebar-footer {
  padding: 16px 20px;
  border-top: 1px solid var(--c-border-light);
}
.version {
  font-size: 0.75rem;
  color: var(--c-text-muted);
}

/* ===== Content ===== */
.doc-content {
  flex: 1;
  padding: var(--gap-xl) var(--gap-lg);
  overflow-y: auto;
}
.doc-section {
  max-width: var(--content-max);
  margin: 0 auto;
  animation: fadeIn 0.35s ease-out;
}
@keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }

.section-header { margin-bottom: 32px; }
.section-header h1 { font-size: 1.75rem; font-weight: 600; color: var(--c-text); margin: 0 0 8px; letter-spacing: -0.02em; }
.subtitle { font-size: 1rem; color: var(--c-text-secondary); margin: 0; }

/* ===== Overview ===== */
.overview-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--gap-md);
}
.overview-card {
  background: var(--c-surface);
  border: 1px solid var(--c-border);
  border-radius: var(--radius-lg);
  padding: 18px;
}
.overview-card.highlight-new {
  background: linear-gradient(135deg, rgba(99,102,241,0.06), rgba(139,92,246,0.1));
  border-color: rgba(99,102,241,0.25);
}
.impl-block.highlight-new {
  background: linear-gradient(135deg, rgba(99,102,241,0.04), rgba(139,92,246,0.08));
  border: 1px solid rgba(99,102,241,0.2);
  border-radius: var(--radius-lg);
  padding: 16px;
}
.impl-block.highlight-new h3 {
  color: #6366f1;
}
.overview-title {
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--c-text-secondary);
  margin-bottom: 8px;
}
.overview-value {
  font-size: 1rem;
  font-weight: 600;
  color: var(--c-text);
  line-height: 1.5;
}
.overview-meta {
  margin-top: 8px;
  font-size: 0.85rem;
  color: var(--c-text-secondary);
  line-height: 1.5;
}

/* ===== Checklist ===== */
.checklist { display: flex; flex-direction: column; gap: 10px; }
.check-item {
  padding: 12px 14px;
  background: var(--c-surface-alt);
  border: 1px solid var(--c-border-light);
  border-radius: var(--radius-sm);
  font-size: 0.9rem;
  color: var(--c-text);
  line-height: 1.6;
}

/* ===== Matrix ===== */
.matrix-wrap { overflow-x: auto; }
.matrix-table {
  min-width: 860px;
  border: 1px solid var(--c-border);
  border-radius: var(--radius-lg);
  overflow: hidden;
  background: var(--c-surface);
}
.matrix-row { display: grid; grid-template-columns: 260px repeat(8, 1fr); }
.matrix-row.header { background: var(--c-surface-alt); border-bottom: 1px solid var(--c-border-light); }
.matrix-row:not(.header) { border-bottom: 1px solid var(--c-border-light); }
.matrix-row:last-child { border-bottom: none; }
.cell {
  padding: 12px 14px;
  font-size: 0.85rem;
  color: var(--c-text-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
}
.cell.row-title { justify-content: flex-start; color: var(--c-text); font-weight: 600; }
.matrix-row.header .cell { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
.dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; border: 1px solid var(--c-border); }
.dot.on { background: var(--c-accent); border-color: var(--c-accent); }
.dot.off { background: transparent; border-color: var(--c-border); }

/* ===== Sequence / Pipeline ===== */
.workflow-pipeline { display: flex; gap: 0; margin-bottom: var(--gap-lg); overflow-x: auto; padding-bottom: var(--gap-sm); }
.pipeline-step { display: flex; align-items: center; flex-shrink: 0; }
.step-connector { width: 42px; height: 2px; background: var(--c-border); margin: 0 10px; }
.step-card-mini {
  width: 260px;
  background: var(--c-surface);
  border: 1px solid var(--c-border);
  border-radius: var(--radius-lg);
  padding: 16px;
}
.step-card-mini.llm { border-left: 4px solid var(--c-info); }
.step-card-mini.logic { border-left: 4px solid var(--c-accent); }
.step-card-mini.gen { border-left: 4px solid var(--c-warning); }
.step-card-mini.verify { border-left: 4px solid #7C3AED; }
.step-mini-head { display: flex; align-items: center; gap: 10px; margin-bottom: 6px; }
.mini-icon { font-size: 0.9rem; font-weight: 700; color: var(--c-text-secondary); }
.step-card-mini h3 { font-size: 1rem; font-weight: 600; color: var(--c-text); margin: 0; }
.step-card-mini p { font-size: 0.85rem; color: var(--c-text-secondary); margin: 0 0 10px; line-height: 1.5; }
.step-details { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; gap: 6px; }
.step-details li { font-size: 0.8rem; color: var(--c-text-secondary); padding-left: 14px; position: relative; line-height: 1.4; }
.step-details li::before { content: 'â€¢'; position: absolute; left: 0; color: var(--c-accent); }
.step-number {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: var(--c-accent);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  margin-bottom: 10px;
}

/* ===== Code map ===== */
.code-map { display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--gap-md); }
.code-map-card { background: var(--c-surface); border: 1px solid var(--c-border); border-radius: var(--radius-lg); overflow: hidden; }
.code-map-head { padding: 14px 16px; background: var(--c-surface-alt); border-bottom: 1px solid var(--c-border-light); display: flex; flex-direction: column; gap: 10px; }
.code-file { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 0.85rem; color: var(--c-text); }
.code-tags { display: flex; flex-wrap: wrap; gap: 6px; }
.code-tag { font-size: 0.75rem; padding: 3px 10px; border-radius: 12px; background: var(--c-accent-bg); color: var(--c-accent); font-weight: 600; }
.code-map-body { padding: 14px 16px; display: flex; flex-direction: column; gap: 12px; }
.code-fn { padding: 10px 12px; background: var(--c-surface-alt); border: 1px solid var(--c-border-light); border-radius: var(--radius-sm); }
.fn-name { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 0.85rem; color: var(--c-text); font-weight: 700; }
.fn-desc { margin-top: 6px; font-size: 0.85rem; color: var(--c-text-secondary); line-height: 1.5; }

/* ===== Raw code blocks ===== */
.code-block.raw { background: var(--c-surface-alt); border: 1px solid var(--c-border-light); }
.code-block.raw pre { color: var(--c-text); white-space: pre; }
.code-block.raw.mt { margin-top: 12px; }

/* Architecture Diagram */
.arch-diagram { margin-bottom: 32px; }
.arch-layer {
  background: var(--c-surface);
  border: 1px solid var(--c-border);
  border-radius: var(--radius-lg);
  padding: 20px;
  margin-bottom: 8px;
}
.arch-layer.client { border-left: 4px solid var(--c-accent); }
.arch-layer.server { border-left: 4px solid var(--c-info); }
.arch-layer.external { border-left: 4px solid var(--c-warning); }
.layer-label { font-size: 0.8rem; font-weight: 600; color: var(--c-text-secondary); text-transform: uppercase; margin-bottom: 12px; }
.layer-content { display: flex; gap: 12px; flex-wrap: wrap; }
.arch-node {
  padding: 8px 16px;
  background: var(--c-surface-alt);
  border-radius: var(--radius-sm);
  font-size: 0.9rem;
  color: var(--c-text);
  border: 1px solid var(--c-border-light);
}
.arch-node.api { background: #FFF7ED; color: #9A3412; border-color: rgba(184,110,0,0.15); }
.arch-arrow { text-align: center; padding: 8px; color: var(--c-text-muted); font-size: 0.85rem; }

.tech-cards { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.tech-card {
  background: var(--c-surface);
  border: 1px solid var(--c-border);
  border-radius: var(--radius-lg);
  padding: 20px;
}
.tech-card h3 { font-size: 1rem; font-weight: 600; margin: 0 0 12px; color: var(--c-text); }
.tech-card ul { list-style: none; padding: 0; margin: 0; }
.tech-card li { padding: 6px 0; font-size: 0.9rem; color: var(--c-text-secondary); }
.tech-card li strong { color: var(--c-text); }

/* Chain Flow */
.chain-flow { display: flex; flex-direction: column; gap: 0; }
.chain-step { display: flex; gap: 16px; }
.step-badge {
  width: 32px;
  height: 32px;
  background: var(--c-accent);
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  flex-shrink: 0;
}
.step-card {
  flex: 1;
  background: var(--c-surface);
  border: 1px solid var(--c-border);
  border-radius: var(--radius-lg);
  padding: 20px;
}
.step-card h3 { font-size: 1rem; font-weight: 600; margin: 0 0 8px; color: var(--c-text); }
.step-model { display: inline-block; padding: 4px 10px; background: rgba(8,131,80,0.12); color: var(--c-accent); border-radius: 6px; font-size: 0.75rem; font-weight: 600; margin-bottom: 12px; }
.step-card p { font-size: 0.9rem; color: var(--c-text-secondary); margin: 0 0 8px; }
.step-card ul { list-style: none; padding: 0; margin: 0; }
.step-card li { padding: 4px 0; font-size: 0.85rem; color: var(--c-text-secondary); padding-left: 16px; position: relative; }
.step-card li::before { content: 'â€¢'; position: absolute; left: 0; color: var(--c-accent); }
.chain-connector { width: 2px; height: 24px; background: rgba(8,131,80,0.35); margin-left: 15px; }

/* Implementation Blocks */
.impl-block {
  background: var(--c-surface);
  border: 1px solid var(--c-border);
  border-radius: var(--radius-lg);
  padding: 24px;
  margin-bottom: 20px;
}
.impl-block h3 { font-size: 1rem; font-weight: 600; margin: 0 0 12px; color: var(--c-text); }
.impl-block p { font-size: 0.9rem; color: var(--c-text-secondary); margin: 0 0 16px; }

.color-demo { display: flex; flex-direction: column; gap: 12px; }
.color-row { display: flex; align-items: center; gap: 16px; }
.color-name { width: 40px; font-size: 0.9rem; font-weight: 500; color: var(--c-text); }
.color-variants { display: flex; gap: 8px; }
.color-chip { width: 48px; height: 32px; border-radius: 6px; border: 1px solid rgba(0,0,0,0.06); }

.rule-table { font-size: 0.85rem; }
.rule-row { display: grid; grid-template-columns: 60px 1fr 1fr 80px 1.5fr; gap: 12px; padding: 10px 0; border-bottom: 1px solid var(--c-border-light); align-items: center; }
.rule-row.header { font-weight: 600; color: var(--c-text-secondary); font-size: 0.8rem; text-transform: uppercase; }
.rule-name { font-weight: 600; color: var(--c-text); }

.code-block {
  background: var(--c-surface-alt);
  border: 1px solid var(--c-border-light);
  border-radius: var(--radius-md);
  padding: 16px;
  overflow-x: auto;
}
.code-block pre {
  margin: 0;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  font-size: 0.8rem;
  line-height: 1.6;
  color: var(--c-text);
}

/* Skeleton Vars */
.var-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 32px; }
.var-card { background: var(--c-surface); border: 1px solid var(--c-border); border-radius: var(--radius-lg); padding: 20px; }
.var-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
.var-num { width: 24px; height: 24px; background: var(--c-warning); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; }
.var-card h3 { font-size: 0.95rem; font-weight: 600; color: var(--c-text); margin: 0; }
.var-desc { font-size: 0.85rem; color: var(--c-text-secondary); margin: 0 0 12px; }
.var-card ul { list-style: none; padding: 0; margin: 0; }
.var-card li { padding: 4px 0; font-size: 0.85rem; color: var(--c-text-secondary); }
.var-card li strong { color: var(--c-text); }

.cliche-table { font-size: 0.85rem; }
.cliche-row { display: grid; grid-template-columns: 60px 1fr 1fr; gap: 16px; padding: 10px 0; border-bottom: 1px solid #F0F0F2; }
.cliche-degree { font-weight: 600; color: #1D1D1F; }
.cliche-bad { color: #DC2626; }
.cliche-good { color: #10B981; }

/* API List */
.api-list { display: flex; flex-direction: column; gap: 16px; }
.api-item { background: var(--c-surface); border: 1px solid var(--c-border); border-radius: var(--radius-lg); padding: 16px 20px; }
.api-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
.api-method { padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
.api-method.get { background: #D1FAE5; color: #065F46; }
.api-method.post { background: #DBEAFE; color: #1E40AF; }
.api-path { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 0.9rem; color: var(--c-text); }
.api-desc { font-size: 0.9rem; color: var(--c-text-secondary); margin: 0; }
.api-params { margin-top: 8px; font-size: 0.85rem; color: var(--c-text-secondary); }
.api-params code { background: var(--c-surface-alt); border: 1px solid var(--c-border-light); padding: 2px 8px; border-radius: 4px; font-family: ui-monospace, monospace; }

@media (max-width: 900px) {
  .mobile-nav { display: flex; }
  .sidebar { display: none; }
  .doc-content { padding: 32px 20px; padding-top: 76px; }
  .var-cards { grid-template-columns: 1fr; }
  .tech-cards { grid-template-columns: 1fr; }
  .overview-grid { grid-template-columns: 1fr; }
  .code-map { grid-template-columns: 1fr; }
}
</style>

